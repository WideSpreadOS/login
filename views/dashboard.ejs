<style>
.user-profile-image-form {
    max-width: 200px;
}
.user-avatar {
    max-width: 200px;
    max-height: 200px;
    border-radius: 50%;
    margin: 0 auto;
    margin-bottom: 30px;
    border-bottom-right-radius: 10px;
    border-bottom-left-radius: 10px;
    overflow: hidden;
    box-shadow: -3px -3px 6px #222, -3px -3px 6px #111, 3px 3px 3px #111,  3px 3px 6px #000, inset 0 0 10px #111;
    padding: 10px;
}
.user-avatar img {
    min-width: 160px;
    min-height: 160px;
    margin: -10px;
    margin-left: -40px;
    opacity: 0.7;
    transition: ease-in 0.4s;
}
@media screen and (max-width: 500px) {
    .user-profile-image-form {
        max-width: 85vw;
        margin-left: 2.5vw;
        display: inline-flex;
        position: relative;
        background: rgba(255, 255, 255, 0.308);
        border: groove 1px rgba(135, 206, 250, 0.555);
        backdrop-filter: blur(2px);
        padding: 10px;
        color: #fff;
        border-radius: 12px;
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.514);
    }
    .custom-file-profile-image {
        width: 55vw;
        border: solid 1px white;
        border-radius: 10px;
    }
    .custom-file-profile-image input {
    }
    .custom-file-profile-image {
        width: 55vw;
        
    }
    .custom-file-profile-image-button {
        width: 20vw;
        position: absolute;
        right: 12px;
        top: 10px;
        padding: 10px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.432);
        backdrop-filter: blur(4px);
        outline: none;
        border: none;
    }
    .user-profile-routes {
        background: rgba(255, 255, 255, 0.178);
        width: auto;
        margin: 0 auto;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.514);
    }
    .user-profile-routes a {
        margin-left: 5px;
        background: rgba(255, 255, 255, 0.377);
        backdrop-filter: blur(4px);
        width: 45%;
        border-radius: 10px;

    }
    .user-images {
    }
    .user-images h1 {
        text-align: center;
        padding-top: 20px;
        border-top: solid 1px lightskyblue;
    }
    .med-image {
        background: rgba(255, 255, 255, 0.288);
        backdrop-filter: blur(2px);
        border: groove 1px rgba(135, 206, 250, 0.555);
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.514);
        margin-bottom: 30px;
    }
    .your-friends {
        text-align: center;
        background: rgba(255, 255, 255, 0.301);
        backdrop-filter: blur(2px);  
        padding: 10px;
        border-radius: 15px;  
    }
    .your-friends a {
        color: lightskyblue;
    }
    .find-new-friends {
        position: relative;
    }
    .find-new-friends {
        min-height: 450px;
    }
    .new-friend {
        position: relative;
        width: 300px;
        height: 400px;
        min-height: 400px;
        margin-left: 20px;
        border-radius: 15px;
        border-top-left-radius: 2px;
        border-top-right-radius: 2px;
    }

    .possible-friend {
        margin-top: -140px;
        min-width: 300px;
        box-shadow: 0 8px rgba(0, 0, 0, 0.445);
        background: rgba(255, 255, 255, 0.37);
        backdrop-filter: blur(2px);
        z-index: 10;
        border-top-left-radius: 2px;
        border-top-right-radius: 2px;
    }
    .possible-friend p {
        color: #fff;
    }
    .possible-friend-background {
        backdrop-filter: blur(0px);
        overflow: hidden;
        border-radius: 15px;
    }
    .possible-friend-image {
        position: absolute;
        z-index: 9;
        top: 0;
        left: 0;
        width: 300px;
        min-height: 100%;
        border-radius: 15px;
    }
    .possible-friend-image img {
        width: 300px;
        min-height: 100%;
        border-radius: 15px;
    }
    .friend-container {
        margin-top: 20px;
    }
    .add-friend-container {
        display: inline-flex;
    }
    .add-friend button {
        border-radius: 50%;
        background: green;
        width: 40px;
        height: 40px;
        margin-right: 5px;
        text-align: center;
        color: #fff;
    }
    .remove-friend button {
        border-radius: 50%;
        background: red;
        width: 40px;
        height: 40px;
        margin-left: 5px;
        text-align: center;
        color: #fff;
    }
    .see-albums {
        width: 80%;
        margin: 0 auto;
        padding: 10px;
        padding-top: 20px;
        margin-bottom: 20px;
        background:rgba(255, 255, 255, 0.404);
        backdrop-filter: blur(2px);
        text-align: center;
        border-radius: 8px;
    }
    .see-albums p {
        color: #fff;
    }
}
</style>
<div class="user-background-image">
    <% if (profile.user_background_image) { %>
        <img src="/image/<%= profile.user_background_image %>" alt="<%= profile.fname %> <%= profile.lname %>'s Avatar">
        <%} else { %>
            <div class="user-background-color" style="width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; background: <%= profile.favColor1 %>"></div>
            <% } %>
</div>
<%- include('partials/mainHeaderSiteMenu') %>
<%- include('partials/mainHeaderPageMenu') %>

<br>
<br>

<div class="row">
    <div class="col-8">
        <h2 class="lead mb-3">Welcome <%= fname %></h2>
    </div>

</div>

<h2 style="text-align: center; margin-bottom: 20px; margin-top: 30px;">Your Dashboard</h2>
<hr style="border-color: rgba(135, 206, 250, 0.623); margin-top: 40px; margin-bottom: 40px; width: 80%; margin-left: 10%;">

<!-- Profile Image -->
<div class="user-avatar">
    <% if (profile.user_avatar) { %>
        <img src="/image/<%= profile.user_avatar  %>" alt="<%= profile.fname %> <%= profile.lname %>'s Avatar" width="260px">
        <%} else { %>
        <img src="images/system/default-user_1a1a1a.png" alt="Default Avatar" width="260px" >
        <% } %>
</div>

<!-- Profile Image -->
<% if (!avatarImage) { %>

        <div class="user-profile-image-form">
            
            <form action="/upload-avatar?_method=PATCH" method="post" enctype="multipart/form-data">
                <input type="text" name="imageOwner" id="imageOwner" style="display: none;" value="<%= id %>">
                        <div class="custom-file-profile-image">
                            <input type="file" name="user_profile_image" id="userProfileImage">
                            <label for="userProfileImage" class="custom-file-label-choose-profile-image">Choose Profile Picture</label>
                        </div>
                        
                        <div>
                            <button type="submit" class="custom-file-profile-image-button">Change</button>
                        </div>
                </form>
            </div>
            <%} else { %>
                <div class="user-profile-image-form">
                    <form action="/upload-avatar?_method=PATCH" method="POST" enctype="multipart/form-data">
                        <input type="text" name="imageOwner" id="imageOwner" style="display: none;" value="<%= id %>">
                        <div class="custom-file-profile-image">
                            <input type="file" name="user_profile_image" id="userProfileImage">
                            <label for="userProfileImage" class="custom-file-label-choose-profile-image">Choose Profile Picture</label>
                        </div>
                        
                        <div>
                            <button type="submit" class="custom-file-profile-image-button">Change</button>
                        </div>
                </form>
                    </form>
                    </div>
                <% } %>

<div class="user-profile-routes">
    <a class="btn btn-dark" href="/users/<%= id %>">See Your Profile</a>
    <a class="btn btn-dark" href="/users/update-profile/<%= id %>">Update Your Profile</a>
</div>
<div class="user-images">

    <hr>
    <h1>Your Photos</h1>

    <div class="outer_cont_container" style="margin-top: 150px;">
        <div class="cont_container">
            <div class="cont_inner_container">
                <% profileImages.forEach(function(image){ %>
                    <div style="padding: 7px;">
                        <div> 
                            <div> 
                                <div class="med-image"> 
                                    <img src="/image/<%= image.img.data %>" width="300px" height="300px"> 
                                    
                                </div> 
                            </div> 
                        </div> 
                        
                    </div>
                    
                    <% }); %>
                    
                </div>
            </div>
        </div>
        <div class="user-profile-image-form">
        
            <form action="/upload" method="post" enctype="multipart/form-data">
                <input type="text" name="imageOwner" id="imageOwner" style="display: none;" value="<%= id %>">
                <div class="custom-file-profile-image">
                    <input type="file" name="user_image" id="userImage">
                    <label for="userImage" class="custom-file-label-choose-profile-image">Upload an Image</label>
                </div>
                
                <div>
                    <button type="submit" class="custom-file-profile-image-button">Add</button>
                </div>
            </form>
        </div>
    </div>
    <a href="/photo-album/<%= profile._id %>">
        <div class="see-albums">
            <p>Your Photo Album's</p>
        </div>
    </a>
    <div class="your-friends">
        <a href="/<%= profile.id %>/friends"><h3>Your Friends</h3></a>
    </div>
    <div class="row">
        <h1 style="text-align: center; width: 100%;">Find New Friends</h1>
        <div class="find-new-friends">
            <% nearbyUsers.forEach(function(friend){ %>
                <% if(nearbyUsers) { %>
            <div class="new-friend">

            
            <div class="possible-friend-background">

                <div class="possible-friend-image">
                    <% if (friend.user_avatar) { %>
                        <img src="/image/<%= friend.user_avatar   %>" alt="<%= profile.fname %> <%= profile.lname %>'s Avatar" width="60px">
                    <%} else { %>
                        <img src="/images/system/default-user_1a1a1a.png" alt="Default Avatar"  width="60px"  >
                        <% } %>
                </div>
            </div>
            <a href="/users/<%= friend.id %>">
                <div class="possible-friend">
                        <h3 style="text-shadow: 0 0 3px <%= friend.favColor1 %>"><%= friend.fname %> <%= friend.lname %></h3>
                        <% if (!friend.town && !friend.state && !friend.country) { %>
                            <br>
                            <br>
                            <% } else { %> 
                                <p><%= friend.town %>, <%= friend.state %></p>
                                <p><%= friend.country %></p>
                                <% } %>
                            </a>
                            <div class="add-friend-container">
                                <div class="add-friend">
                                    <form action="/users/<%= profile._id %>/add-friend" method="POST">
                                        <input type="text" name="friends" value="<%= friend.id %>" style="display: none;">
                                        <button class="" type="submit">
                                            <i class="fas fa-user-plus"></i>
                                        </button>
                                    </form>
                                </div>
                        <div class="remove-friend">
                            <form action="/users/<%= profile._id %>/remove-friend?_method=PATCH" method="POST">
                                <input type="text" name="friends" value="<%= friend.id %>" style="display: none;">
                                <button class="" type="submit">
                                    <i class="fas fa-user-minus"></i>
                                </button>
                            </form>
                        </div>

                    </div>
                    </div>
                </div>
                <%} else { %>
                    <span></span> 
                    <% } %>
            <% }) %>
        </div>
    </div>

    <div class="row">
            <div class="col-12 user-posts">
                <div class="create-post">
                    <h5>Create New Post</h5>
                    <form action="/users/<%= id %>/post" method="POST">
                        <textarea required name="postBody" id="postBody" class="form-control"></textarea>
                        <button class="btn-block block-button spread-it" type="submit">Spread It</button>
                    </form>
                </div>
            </div>
    </div>
    
    <div class="row">
        <div class="col-12 user-posts">
            <div class="create-post">
                <h5>Create New Article</h5>
                <form action="/users/<%= id %>/article" method="POST">
                    <input type="text" name="articleTitle" placeholder="Article Title" id="articleTitle"></input>
                    <input type="text" name="articleHeader" id="articleHeader" placeholder="Article Header">
                    <textarea required name="articleBody" id="articleBody" class="form-control"></textarea>
                    <button class="btn-block block-button spread-it" type="submit">Spread It</button>
                </form>
            </div>
        </div>
    </div>


    <div class="nav-bar-outer">
        <div class="nav-bar nav-bar-ws">
            <div class="create-post">

                <form action="/upload-video" method="post" enctype="multipart/form-data">
                    <div class="custom-file">
                        <input type="file" name="user_video" id="userVideo">
                        <label for="userVideo" class="custom-file-label">Upload a Video</label>
                    </div>
                    <input type="text" name="imageOwner" id="imageOwner" style="display: none;" value="<%= id %>">
                    <input type="text" name="videoName" id="videoName" placeholder="Video Title" style="margin-top: 15px;">
                    <input type="text" name="user_tags" id="user_tags" placeholder="Tag friends in this video">
                    <input type="text" name="catagory_tags" id="catagory_tags" placeholder="Add Catagory Tags">
                    <button type="submit" disabled class="btn btn-block btn-success">Add Video</button>
                </form>
            </div>
        </div>
    </div>

